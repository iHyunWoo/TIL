# 쿠키와 세션

## HTTP 프로토콜의 특징
- Connectionless
	- HTTP 프로토콜은 클라이언트에서 서보에 요청을 보내면, 서버는 클라이언트에  응답을 보내고 연결을 끊음
- Stateless
	- 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보를 유지하지 않음   

-> 이러한 HTTP 프로토콜의 특징을 보완하고자 쿠키와 세션을 사용

## 쿠키
- 웹 서버가 클라이언트에 전송하는 작은 데이터 파일. 브라우저에 저장
- 사용자 상태 정보나 선호 데이터 등 저장하는데 활용
- 한 도메인 당 20개, 한 쿠키 당 4KB의 용량 제한

### 쿠키의 작동 방식(로그인 예시)
1. 클라이언트가 서버에 로그인 요청
2. 서버는 클라이언트 요청을 검증하고 이상 없다면 응답 헤더에 set-cookie를 통해 쿠키를 추가
	`set-cookie:username=kevin`
3. 클라이언트는 이후 서버에 요청할 때 전달받은 쿠키를 자동으로 요청 헤더에 추가하여 요청
### 쿠키의 종류
- Session Cookie
	- 일반적으로 만료시간을 설정하고, 메모리에 저장하여 브라우저 종료 시 삭제
- Persistent Cookie
	- 장기간 유지되는 쿠키. 파일로 저장되어 브라우저 종료와 관계없이 사용
- Secure Cookie
	- HTTPS 프로토콜에서 사용하며, 쿠키 정보가 암호화되어 전송
- Third-Party Cookie
	- 방문한 도메인과 다른 도메인의 쿠키. 사용자 유입 경로 추적 및 맞춤형 광고에 사용

### 쿠키 보안 속성
- HttpOnly
	- JS에서 쿠키에 접근못하게 하여 XSS 공격 방지
- Secure
	- HTTPS환경에서만 쿠키가 전송되도록 하여 중간자 공격 방지
- SameSite
	- CSRF 공격을 예방하기 위해 다른 도메인으로부터의 쿠키 전송 제한

## 세션
- 서버에서 관리하는 사용자 상태 저장소로 사용자가 서비스를 이용하는 동안의 상태를 유지
- 사용자 정보를 서버에 저장하여 보안성이 좋지만, 서버에 부하 발생 가능

### 세션의 동작 방식(로그인 예시)
1. 클라이언트가 서버에 로그인 요청
2. 서버는 클라이언트 요청을 검증하고 이상 없다면  sessionID를 생성, 응답 헤더에 set-cookie를 통해 쿠키에 저장
	`set-cookie:sessionid:abcd123`
3. 클라이언트는 이후 서버에 요청할 때 전달받은 쿠키를 자동으로 요청 헤더에 추가하여 요청