# 교착 상태(Deadlock)

## 데드락의 특징
- 두 개 이상의 스레드가 서로가 점유하고 있는 자원을 기다리며 무한정 대기하는 상황
- 4가지 조건
	1. 상호 배제 (Mutual Exclusion): 한 번에 하나의 스레드만 자원을 사용할 수 있음
	2. 점유 및 대기 (Hold and Wait): 한 스레드가 자원을 점유한 채 다른 자원을 기다림
	3. 비선점 (No Preemption): 다른 스레드가 점유한 자원을 강제로 빼앗을 수 없음
	4. 순환 대기 (Circular Wait): 스레드들이 자원을 점유한 채 서로가 필요한 자원을 기다리는 순환 관계를 형성함

## 데드락의 예방
1. 상호 배제 예방
	- 임계 구역을 보호하기 위해 상호 배제를 하는건데 이를 제외하는건 말이 안됨
2. 점유 및 대기 예방
	- 자원을 얻지 못한 상태로만 자원을 요청할 수 있도록
3. 비선점 예방
	- 다른 스레드가 자원을 뺏어갈 수 있도록 함
4. 순환 대기 예방
	- 자원을 한 방향으로만 사용하도록 설정
	- 모든 자원의 숫자를 부여하고 숫자가 큰 방향으로만 자원 할당

## 데드락의 회피
- 데드락 예방으로는 오히려 장치의 이용률이 저하하고 처리율이 감소할 수 있음
- 데드락 회피란 자원을 요청할 때마다 시스템의 상태를 검사하여 그 요청이 시스템을 데드락 상태로 만들 가능성이 있는지를 판단. 만약 요청이 시스템을 교착상태로 이끌 가능성이 있다면, 요청을 거부하거나 지연
- 은행원 알고리즘
	- 작업이 최대로 요구할 수 있는 자원의 양을 미리 알고 있어야 함
	- 자원을 요청할 때, 요청이 시스템을 안전 상태로 유지할 수 있는지 판단.
	- 시스템을 불안전 상태로 만들 가능성이 있다면 요청을 거부하거나 지연
	- 안전상태: 데드락을 일으키지 않고 각 작업이 요구한 양만큼 자원을 할당해줄 수 있는 순서가 존재
- 자원 할당 그래프 알고리즘
	- 각 자원 유형이 하나의 인스턴스만 가지고 있는 경우에 사용
	- 그래프에서 사이클이 존재하지 않으면 시스템이 안전 상태에 있다고 판단
- 장점
	- 데드락을 방지할 수 있으며, 자원의 사용률을 높일 수 있음
- 단점
	- 자원 요규랑을 미리 알아야 하는데, 항상 가능한 것은 아님.
	- 지속적으로 시스템의 자원 할당 상태를 모니터링 해야하므로 오버헤드 발생
	- 자원의 할당과 회수가 빈번할 경우 성능 하락

## 데드락의 탐지와 회복
- 데드락 탐지는 주기적으로 시스템을 검사하여 데드락 존재 여부를 확인하는 과정
- 자원 할당 그래프를 통해 사이클이 생기면 데드락이 발생했음을 의미
- 데드락 탐지 후 시스템을 다시 정상 상태로 복구해야 함(회복)
	- 프로세스 종료
		- 데드락과 관련된 프로세스 하나 이상을 종료
	- 자원 선점
		- 하나 이상의 프로세스로부터 자원을 강제로 회수


## Reference
<!-- 사용하지 않는 레퍼런스 종류는 삭제 후 업로드 -->
- [교착상태](https://wikidocs.net/201151)
- [스레드 동기화와 교착 상태(Deadlock)](https://marmelo12.tistory.com/362)